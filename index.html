<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Google Drive - Vista de documento</title>
<link href="https://fonts.googleapis.com/css2?family=Google+Sans:wght@400;500;700&family=Roboto:wght@300;400;500&display=swap" rel="stylesheet">
<style>
:root{--google-blue:#1a73e8;--google-blue-hover:#0d62d9;--google-green:#34a853;--google-yellow:#f9ab00;--google-red:#d93025;--google-gray-50:#f8f9fa;--google-gray-100:#f1f3f4;--google-gray-200:#e8eaed;--google-gray-300:#dadce0;--google-gray-700:#5f6368;--google-gray-900:#202124}
*{margin:0;padding:0;box-sizing:border-box}
body{font-family:'Roboto','Segoe UI',Arial,sans-serif;background:linear-gradient(135deg,#f8f9fa 0%,#e8f0fe 100%);min-height:100vh;display:flex;justify-content:center;align-items:center;color:var(--google-gray-900);line-height:1.5;padding:20px}
.drive-container{width:100%;max-width:520px;background:#fff;border-radius:12px;box-shadow:0 1px 3px rgba(60,64,67,.08),0 8px 40px rgba(60,64,67,.12);overflow:hidden;animation:slideUp .3s ease-out}
.drive-header{background:#fff;padding:24px 32px;border-bottom:1px solid var(--google-gray-200);display:flex;align-items:center;gap:16px}
.drive-logo{width:40px;height:40px;background:#fff;border-radius:8px;display:flex;align-items:center;justify-content:center;border:1px solid var(--google-gray-200)}
.drive-title{flex:1}
.drive-title h1{font-family:'Google Sans',sans-serif;font-size:20px;font-weight:500;color:var(--google-gray-900);margin-bottom:4px}
.drive-title p{font-size:14px;color:var(--google-gray-700)}
.drive-content{padding:32px;text-align:center}
.document-preview{background:var(--google-gray-50);border-radius:8px;padding:32px;margin-bottom:24px;border:1px solid var(--google-gray-200)}
.pdf-icon{width:64px;height:64px;background:var(--google-red);border-radius:8px;margin:0 auto 16px;display:flex;align-items:center;justify-content:center;font-size:28px;color:#fff;font-weight:700}
.document-info h2{font-family:'Google Sans',sans-serif;font-size:18px;font-weight:500;margin-bottom:8px;color:var(--google-gray-900)}
.document-info p{font-size:14px;color:var(--google-gray-700);margin-bottom:4px}
.drive-button{background:var(--google-blue);color:#fff;border:0;padding:12px 24px;border-radius:4px;font-family:'Google Sans',sans-serif;font-size:14px;font-weight:500;cursor:pointer;display:inline-flex;align-items:center;gap:8px;transition:all .2s;min-width:200px;justify-content:center}
.drive-button:hover{background:var(--google-blue-hover);box-shadow:0 1px 3px rgba(66,133,244,.3)}
.drive-button:disabled{background:var(--google-gray-300);cursor:not-allowed;transform:none;box-shadow:none}
.loading-state{display:none;margin-top:24px;animation:fadeIn .3s ease}
.progress-bar{height:4px;background:var(--google-gray-200);border-radius:2px;overflow:hidden;margin-bottom:16px}
.progress-fill{height:100%;background:var(--google-green);width:0;transition:width .3s ease}
.loading-steps{text-align:left;max-width:300px;margin:0 auto}
.loading-step{display:flex;align-items:center;gap:12px;margin-bottom:12px;font-size:14px;color:var(--google-gray-700)}
.step-check{width:20px;height:20px;border-radius:50%;background:var(--google-gray-200);display:flex;align-items:center;justify-content:center;font-size:12px;color:#fff}
.step-check.completed{background:var(--google-green)}
.drive-footer{padding:16px 32px;border-top:1px solid var(--google-gray-200);background:var(--google-gray-50);font-size:12px;color:var(--google-gray-700);text-align:center}
.security-info{display:flex;align-items:center;justify-content:center;gap:8px;margin-top:8px}
@keyframes slideUp{from{opacity:0;transform:translateY(20px)}to{opacity:1;transform:translateY(0)}}
@keyframes fadeIn{from{opacity:0}to{opacity:1}}
@media(max-width:600px){.drive-container{border-radius:0}.drive-header,.drive-content,.drive-footer{padding:20px}}
.pdf-not-found{text-align:center;padding:40px 20px;color:var(--google-gray-700)}
.pdf-not-found h3{font-family:'Google Sans',sans-serif;font-size:18px;color:var(--google-red);margin-bottom:12px}
.pdf-list{text-align:left;max-width:300px;margin:20px auto;background:var(--google-gray-50);padding:15px;border-radius:8px;border:1px solid var(--google-gray-200)}
.pdf-list h4{font-family:'Google Sans',sans-serif;font-size:14px;margin-bottom:10px;color:var(--google-gray-900)}
.pdf-list ul{list-style:none;font-size:13px}
.pdf-list li{padding:5px 0;border-bottom:1px solid var(--google-gray-200)}
.pdf-list li:last-child{border-bottom:0}
.pdf-link{color:var(--google-blue);text-decoration:none}
.pdf-link:hover{text-decoration:underline}
</style>
</head>
<body>
<div class="drive-container">
<div class="drive-header">
<div class="drive-logo">
<svg width="24" height="24" viewBox="0 0 24 24" fill="#5f6368">
  <path d="M19.35 10.04A7.49 7.49 0 0 0 12 4C9.11 4 6.6 5.64 5.35 8.04A5.994 5.994 0 0 0 0 14c0 3.31 2.69 6 6 6h13c2.76 0 5-2.24 5-5 0-2.64-2.05-4.78-4.65-4.96zM19 18H6c-2.21 0-4-1.79-4-4s1.79-4 4-4h.71C7.37 7.69 9.48 6 12 6c2.97 0 5.45 2.18 5.92 5.02.21.03.41.08.6.14.46.15.83.41 1.13.76.18.21.33.45.44.71.14.33.22.69.22 1.07 0 1.66-1.34 3-3 3z"/>
</svg>

</div>
<div class="drive-title">
<h1>Google Drive</h1>
<p>Documento compartido • Solo ver</p>
</div>
</div>
<div class="drive-content">
<div class="document-preview">
<div class="pdf-icon">PDF</div>
<div class="document-info">
<h2 id="pdfTitle">Visor de PDF de Google Drive</h2>
<p id="pdfDescription">• Carpeta compartida •</p>
<p id="pdfAccess">• Acceso general •</p>
<p id="pdfFeature">• Ahora impulsada con Gemini 2.4 •</p>
</div>
</div>
<button class="drive-button" id="openBtn" onclick="openDocument()">
<svg width="18" height="18" viewBox="0 0 24 24" fill="currentColor"><path d="M19 9h-4V3H9v6H5l7 7 7-7zM5 18v2h14v-2H5z"/></svg>
<span>Abrir en Visor PDF</span>
</button>
<div class="loading-state" id="loadingState">
<div class="progress-bar"><div class="progress-fill" id="progressFill"></div></div>
<div class="loading-steps">
<div class="loading-step"><div class="step-check" id="step1">1</div><span>Preparando visor seguro...</span></div>
<div class="loading-step"><div class="step-check" id="step2">2</div><span>Verificando permisos...</span></div>
<div class="loading-step"><div class="step-check" id="step3">3</div><span>Cargando documento...</span></div>
</div>
</div>
<div class="pdf-not-found" id="pdfNotFound" style="display:none">
<h3>PDF no encontrado</h3>
<p>El documento solicitado no está disponible en nuestro sistema.</p>
<div class="pdf-list">
<h4>Documentos disponibles:</h4>
<ul id="availablePdfs"></ul>
</div>
<p style="margin-top:20px;font-size:13px">Usa uno de los enlaces anteriores o visita la página principal.</p>
</div>
</div>
<div class="drive-footer">
<p>Google Drive • Documento protegido por derechos de autor</p>
<div class="security-info">
<svg width="14" height="14" viewBox="0 0 24 24" fill="#34a853"><path d="M12 1L3 5v6c0 5.55 3.84 10.74 9 12 5.16-1.26 9-6.45 9-12V5l-9-4zm0 10.99h7c-.53 4.12-3.28 7.79-7 8.94V12H5V6.3l7-3.11v8.8z"/></svg>
<span>Conexión segura • Encriptado de extremo a extremo</span>
</div>
</div>
</div>
<script>
// ============================================
// CONFIGURACIÓN DE PDFs CON IDs DE DRIVE (EDITABLE)
// ============================================
const pdfDatabase = {
    "video": {
        title: "Visor Drive",
        description: "• Video.mp4 •",
        access: "• Acceso solo ver •",
        feature: "• Ahora con Gemini v2.5 •",
        driveId: "1LyaYTFCFGUuFtpV2yPaJcYO-DLLeswdl"
    },
    "desarrollo-lab": {
        title: "Desarrollo Laboratorio 04 OPAM",
        description: "• Acceso autorizado general •",
        access: "• Protocolos actualizados v3.2 •",
        feature: "• Ahora con Gemini v2.5 •",
        driveId: "TU_ID_DE_DRIVE_AQUI_2"
    },
    "Lab2": {
        title: "Reporte de Seguridad",
        description: "• Análisis de vulnerabilidades •",
        access: "• Acceso restringido al departamento •",
        feature: "• Protegido con encriptación AES-256 •",
        driveId: "TU_ID_DE_DRIVE_AQUI_3"
    }
};

// ============================================
//-------------------------------------------
// ============================================
const urlParams = new URLSearchParams(window.location.search);
const requestedPdf = urlParams.get('pdf');
const pdfTitle = document.getElementById('pdfTitle');
const pdfDescription = document.getElementById('pdfDescription');
const pdfAccess = document.getElementById('pdfAccess');
const pdfFeature = document.getElementById('pdfFeature');
const openBtn = document.getElementById('openBtn');
const pdfNotFound = document.getElementById('pdfNotFound');
const availablePdfsList = document.getElementById('availablePdfs');
const loadingState = document.getElementById('loadingState');
const progressFill = document.getElementById('progressFill');
const step1 = document.getElementById('step1');
const step2 = document.getElementById('step2');
const step3 = document.getElementById('step3');

let currentPdfKey = null;

function initializeInterface() {
    if (requestedPdf) {
        if (pdfDatabase[requestedPdf]) {
            const pdfInfo = pdfDatabase[requestedPdf];
            currentPdfKey = requestedPdf;
            updateInterface(pdfInfo);
            openBtn.style.display = 'inline-flex';
            pdfNotFound.style.display = 'none';
            document.title = `Google Drive - ${pdfInfo.title}`;
        } else {
            showDocumentNotFound();
        }
    } else {
        const firstPdfKey = Object.keys(pdfDatabase)[0];
        if (firstPdfKey) {
            const pdfInfo = pdfDatabase[firstPdfKey];
            currentPdfKey = firstPdfKey;
            updateInterface(pdfInfo);
            openBtn.style.display = 'inline-flex';
            pdfNotFound.style.display = 'none';
        } else {
            showDocumentNotFound();
        }
    }
    
    if (requestedPdf) {
        const newUrl = `${window.location.origin}${window.location.pathname}?pdf=${encodeURIComponent(requestedPdf)}`;
        window.history.replaceState({}, document.title, newUrl);
    }
}

function updateInterface(pdfInfo) {
    pdfTitle.textContent = pdfInfo.title;
    pdfDescription.textContent = pdfInfo.description;
    pdfAccess.textContent = pdfInfo.access;
    pdfFeature.textContent = pdfInfo.feature;
}

function showDocumentNotFound() {
    pdfTitle.textContent = "Documento no disponible";
    pdfDescription.textContent = "• El archivo solicitado no existe •";
    pdfAccess.textContent = "• Verifique el nombre del documento •";
    pdfFeature.textContent = "• Contacte al administrador •";
    openBtn.style.display = 'none';
    showAvailablePdfs();
    pdfNotFound.style.display = 'block';
}

function showAvailablePdfs() {
    availablePdfsList.innerHTML = '';
    for (const pdfKey in pdfDatabase) {
        const li = document.createElement('li');
        const a = document.createElement('a');
        a.href = `?pdf=${encodeURIComponent(pdfKey)}`;
        a.className = 'pdf-link';
        a.textContent = pdfDatabase[pdfKey].title;
        li.appendChild(a);
        availablePdfsList.appendChild(li);
    }
}

function updateProgress(step) {
    const steps = [step1, step2, step3];
    const progress = (step / 3) * 100;
    progressFill.style.width = `${progress}%`;
    
    for (let i = 0; i < step; i++) {
        if (i < steps.length) {
            steps[i].innerHTML = '✓';
            steps[i].classList.add('completed');
        }
    }
}

function openDocument() {
    if (openBtn.innerHTML.includes('Documento abierto')) {
        location.reload();
        return;
    }
    
    let pdfKeyToUse = currentPdfKey;
    if (!pdfKeyToUse) {
        pdfKeyToUse = Object.keys(pdfDatabase)[0];
    }
    
    if (!pdfDatabase[pdfKeyToUse]) {
        showError('No se encontró el documento solicitado.');
        return;
    }
    
    const driveId = pdfDatabase[pdfKeyToUse].driveId;
    
    // URL CORREGIDA - usando "sharing" en lugar de "view"
    const driveUrl = `https://drive.google.com/file/d/${driveId}/view?usp=sharing`;
    
    openBtn.disabled = true;
    openBtn.innerHTML = '<span>Preparando visualización...</span>';
    loadingState.style.display = 'block';
    updateProgress(1);
    
    const screenWidth = window.screen.availWidth;
    const screenHeight = window.screen.availHeight;
    const popupWidth = 1000;
    const popupHeight = 700;
    const left = Math.max(0, (screenWidth - popupWidth) / 2);
    const top = Math.max(0, (screenHeight - popupHeight) / 2);
    
    // Abrir directamente Google Drive - SIN página intermedia
    const popup = window.open(
        driveUrl, // ABRE DIRECTAMENTE GOOGLE DRIVE
        'google_drive_viewer', 
        `width=${popupWidth},height=${popupHeight},left=${left},top=${top},scrollbars=yes,resizable=yes,status=yes,toolbar=no,location=yes,menubar=no`
    );
    
    if (!popup) {
        showError('Por favor permita ventanas emergentes para ver este documento.');
        return;
    }
    
    updateProgress(2);
    
    setTimeout(() => {
        updateProgress(3);
        
        setTimeout(() => {
            openBtn.innerHTML = `<svg width="18" height="18" viewBox="0 0 24 24" fill="currentColor"><path d="M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z"/></svg><span>Documento abierto</span>`;
            openBtn.style.background = 'var(--google-green)';
            openBtn.disabled = false;
            
            setTimeout(() => {
                loadingState.innerHTML = `
                    <div style="text-align:center;padding:10px;color:var(--google-green)">
                        <svg width="48" height="48" viewBox="0 0 24 24" fill="currentColor">
                            <path d="M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z"/>
                        </svg>
                        <p style="margin-top:12px;font-weight:500">Documento cargado correctamente</p>
                        <p style="font-size:13px;color:var(--google-gray-700);margin-top:4px">
                            El documento se ha abierto en una ventana emergente. 
                            Puede cerrar esta ventana cuando termine de revisar el documento.
                        </p>
                    </div>`;
            }, 1000);
        }, 500);
    }, 500);
}

function showError(message) {
    loadingState.innerHTML = `
        <div style="text-align:center;padding:20px;color:var(--google-red)">
            <svg width="48" height="48" viewBox="0 0 24 24" fill="currentColor">
                <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 15h-2v-2h2v2zm0-4h-2V7h2v6z"/>
            </svg>
            <p style="margin-top:12px;font-weight:500">Error al cargar documento</p>
            <p style="font-size:14px;color:var(--google-gray-700);margin-top:8px">${message}</p>
            <button onclick="location.reload()" style="background:var(--google-blue);color:#fff;border:0;padding:8px 16px;border-radius:4px;margin-top:16px;cursor:pointer;font-family:'Google Sans',sans-serif;font-size:14px">
                Reintentar
            </button>
        </div>`;
    loadingState.style.display = 'block';
    openBtn.disabled = false;
    openBtn.innerHTML = '<span>Reintentar apertura</span>';
    openBtn.style.background = 'var(--google-blue)';
}

document.addEventListener('DOMContentLoaded', initializeInterface);
</script>
</body>
</html>